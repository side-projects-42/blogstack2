{"expireTime":9007200914465209000,"key":"transformer-remark-markdown-html-ast-a13a5e139542bfac961246e7954feba7--","val":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"Async functions:","position":{"start":{"line":2,"column":3,"offset":3},"end":{"line":2,"column":19,"offset":19}}}],"position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":19,"offset":19}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Asynchronous JavaScript","position":{"start":{"line":3,"column":4,"offset":23},"end":{"line":3,"column":27,"offset":46}}}],"position":{"start":{"line":3,"column":1,"offset":20},"end":{"line":3,"column":27,"offset":46}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's start with the ","position":{"start":{"line":5,"column":1,"offset":48},"end":{"line":5,"column":22,"offset":69}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":5,"column":22,"offset":69},"end":{"line":5,"column":29,"offset":76}}},{"type":"text","value":" keyword. It can be placed before a function, like this:","position":{"start":{"line":5,"column":29,"offset":76},"end":{"line":5,"column":85,"offset":132}}}],"position":{"start":{"line":5,"column":1,"offset":48},"end":{"line":5,"column":85,"offset":132}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function f() {\n    return 1;\n}\n"}],"position":{"start":{"line":7,"column":1,"offset":134},"end":{"line":12,"column":4,"offset":183}}}],"position":{"start":{"line":7,"column":1,"offset":134},"end":{"line":12,"column":4,"offset":183}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The word \"async\" before a function means one simple thing: a function always returns a promise. Other values are wrapped in a resolved promise automatically.","position":{"start":{"line":14,"column":1,"offset":185},"end":{"line":14,"column":158,"offset":342}}}],"position":{"start":{"line":14,"column":1,"offset":185},"end":{"line":14,"column":158,"offset":342}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"For instance, this function returns a resolved promise with the result of ","position":{"start":{"line":16,"column":1,"offset":344},"end":{"line":16,"column":75,"offset":418}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"1"}],"position":{"start":{"line":16,"column":75,"offset":418},"end":{"line":16,"column":78,"offset":421}}},{"type":"text","value":"; let's test it:","position":{"start":{"line":16,"column":78,"offset":421},"end":{"line":16,"column":94,"offset":437}}}],"position":{"start":{"line":16,"column":1,"offset":344},"end":{"line":16,"column":94,"offset":437}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function f() {\n    return 1;\n}\n\nf().then(alert); // 1\n"}],"position":{"start":{"line":18,"column":1,"offset":439},"end":{"line":25,"column":4,"offset":511}}}],"position":{"start":{"line":18,"column":1,"offset":439},"end":{"line":25,"column":4,"offset":511}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"...We could explicitly return a promise, which would be the same:","position":{"start":{"line":27,"column":1,"offset":513},"end":{"line":27,"column":66,"offset":578}}}],"position":{"start":{"line":27,"column":1,"offset":513},"end":{"line":27,"column":66,"offset":578}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function f() {\n    return Promise.resolve(1);\n}\n\nf().then(alert); // 1\n"}],"position":{"start":{"line":29,"column":1,"offset":580},"end":{"line":36,"column":4,"offset":669}}}],"position":{"start":{"line":29,"column":1,"offset":580},"end":{"line":36,"column":4,"offset":669}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So, ","position":{"start":{"line":38,"column":1,"offset":671},"end":{"line":38,"column":5,"offset":675}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":38,"column":5,"offset":675},"end":{"line":38,"column":12,"offset":682}}},{"type":"text","value":" ensures that the function returns a promise, and wraps non-promises in it. Simple enough, right? But not only that. There's another keyword, ","position":{"start":{"line":38,"column":12,"offset":682},"end":{"line":38,"column":154,"offset":824}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":38,"column":154,"offset":824},"end":{"line":38,"column":161,"offset":831}}},{"type":"text","value":", that works only inside ","position":{"start":{"line":38,"column":161,"offset":831},"end":{"line":38,"column":186,"offset":856}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":38,"column":186,"offset":856},"end":{"line":38,"column":193,"offset":863}}},{"type":"text","value":" functions, and it's pretty cool.","position":{"start":{"line":38,"column":193,"offset":863},"end":{"line":38,"column":226,"offset":896}}}],"position":{"start":{"line":38,"column":1,"offset":671},"end":{"line":38,"column":226,"offset":896}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#await"},"children":[{"type":"text","value":"Await","position":{"start":{"line":40,"column":5,"offset":902},"end":{"line":40,"column":10,"offset":907}}}],"position":{"start":{"line":40,"column":4,"offset":901},"end":{"line":40,"column":19,"offset":916}}}],"position":{"start":{"line":40,"column":1,"offset":898},"end":{"line":40,"column":19,"offset":916}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The syntax:","position":{"start":{"line":42,"column":1,"offset":918},"end":{"line":42,"column":12,"offset":929}}}],"position":{"start":{"line":42,"column":1,"offset":918},"end":{"line":42,"column":12,"offset":929}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\n// works only inside async functions\nlet value = await promise;\n"}],"position":{"start":{"line":44,"column":1,"offset":931},"end":{"line":48,"column":4,"offset":1007}}}],"position":{"start":{"line":44,"column":1,"offset":931},"end":{"line":48,"column":4,"offset":1007}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The keyword ","position":{"start":{"line":50,"column":1,"offset":1009},"end":{"line":50,"column":13,"offset":1021}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":50,"column":13,"offset":1021},"end":{"line":50,"column":20,"offset":1028}}},{"type":"text","value":" makes JavaScript wait until that promise settles and returns its result.","position":{"start":{"line":50,"column":20,"offset":1028},"end":{"line":50,"column":93,"offset":1101}}}],"position":{"start":{"line":50,"column":1,"offset":1009},"end":{"line":50,"column":93,"offset":1101}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here's an example with a promise that resolves in 1 second:","position":{"start":{"line":52,"column":1,"offset":1103},"end":{"line":52,"column":60,"offset":1162}}}],"position":{"start":{"line":52,"column":1,"offset":1103},"end":{"line":52,"column":60,"offset":1162}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function f() {\n    let promise = new Promise((resolve, reject) => {\n        setTimeout(() => resolve('done!'), 1000);\n    });\n\n    let result = await promise; // wait until the promise resolves (*)\n\n    alert(result); // \"done!\"\n}\n\nf();\n"}],"position":{"start":{"line":54,"column":1,"offset":1164},"end":{"line":67,"column":4,"offset":1419}}}],"position":{"start":{"line":54,"column":1,"offset":1164},"end":{"line":67,"column":4,"offset":1419}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The function execution \"pauses\" at the line ","position":{"start":{"line":69,"column":1,"offset":1421},"end":{"line":69,"column":45,"offset":1465}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"(*)"}],"position":{"start":{"line":69,"column":45,"offset":1465},"end":{"line":69,"column":50,"offset":1470}}},{"type":"text","value":" and resumes when the promise settles, with ","position":{"start":{"line":69,"column":50,"offset":1470},"end":{"line":69,"column":94,"offset":1514}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"result"}],"position":{"start":{"line":69,"column":94,"offset":1514},"end":{"line":69,"column":102,"offset":1522}}},{"type":"text","value":" becoming its result. So the code above shows \"done!\" in one second.","position":{"start":{"line":69,"column":102,"offset":1522},"end":{"line":69,"column":170,"offset":1590}}}],"position":{"start":{"line":69,"column":1,"offset":1421},"end":{"line":69,"column":170,"offset":1590}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's emphasize: ","position":{"start":{"line":71,"column":1,"offset":1592},"end":{"line":71,"column":18,"offset":1609}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":71,"column":18,"offset":1609},"end":{"line":71,"column":25,"offset":1616}}},{"type":"text","value":" literally suspends the function execution until the promise settles, and then resumes it with the promise result. That doesn't cost any CPU resources, because the JavaScript engine can do other jobs in the meantime: execute other scripts, handle events, etc.","position":{"start":{"line":71,"column":25,"offset":1616},"end":{"line":71,"column":284,"offset":1875}}}],"position":{"start":{"line":71,"column":1,"offset":1592},"end":{"line":71,"column":284,"offset":1875}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It's just a more elegant syntax of getting the promise result than ","position":{"start":{"line":73,"column":1,"offset":1877},"end":{"line":73,"column":68,"offset":1944}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"promise.then"}],"position":{"start":{"line":73,"column":68,"offset":1944},"end":{"line":73,"column":82,"offset":1958}}},{"type":"text","value":". And, it's easier to read and write.","position":{"start":{"line":73,"column":82,"offset":1958},"end":{"line":73,"column":119,"offset":1995}}}],"position":{"start":{"line":73,"column":1,"offset":1877},"end":{"line":73,"column":119,"offset":1995}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Can't use ","position":{"start":{"line":75,"column":1,"offset":1997},"end":{"line":75,"column":11,"offset":2007}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":75,"column":11,"offset":2007},"end":{"line":75,"column":18,"offset":2014}}},{"type":"text","value":" in regular functions","position":{"start":{"line":75,"column":18,"offset":2014},"end":{"line":75,"column":39,"offset":2035}}}],"position":{"start":{"line":75,"column":1,"offset":1997},"end":{"line":75,"column":39,"offset":2035}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we try to use ","position":{"start":{"line":77,"column":1,"offset":2037},"end":{"line":77,"column":18,"offset":2054}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":77,"column":18,"offset":2054},"end":{"line":77,"column":25,"offset":2061}}},{"type":"text","value":" in a non-async function, there would be a syntax error:","position":{"start":{"line":77,"column":25,"offset":2061},"end":{"line":77,"column":81,"offset":2117}}}],"position":{"start":{"line":77,"column":1,"offset":2037},"end":{"line":77,"column":81,"offset":2117}}},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[],"position":{"start":{"line":79,"column":1,"offset":2119},"end":{"line":79,"column":4,"offset":2122}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\n\n\nfunction f() {\n    let promise = Promise.resolve(1);\n    let result = await promise; // Syntax error\n}\n"}],"position":{"start":{"line":82,"column":1,"offset":2125},"end":{"line":90,"column":4,"offset":2242}}}],"position":{"start":{"line":82,"column":1,"offset":2125},"end":{"line":90,"column":4,"offset":2242}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We may get this error if we forget to put ","position":{"start":{"line":92,"column":1,"offset":2244},"end":{"line":92,"column":43,"offset":2286}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":92,"column":43,"offset":2286},"end":{"line":92,"column":50,"offset":2293}}},{"type":"text","value":" before a function. As stated earlier, ","position":{"start":{"line":92,"column":50,"offset":2293},"end":{"line":92,"column":89,"offset":2332}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":92,"column":89,"offset":2332},"end":{"line":92,"column":96,"offset":2339}}},{"type":"text","value":" only works inside an ","position":{"start":{"line":92,"column":96,"offset":2339},"end":{"line":92,"column":118,"offset":2361}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":92,"column":118,"offset":2361},"end":{"line":92,"column":125,"offset":2368}}},{"type":"text","value":" function.","position":{"start":{"line":92,"column":125,"offset":2368},"end":{"line":92,"column":135,"offset":2378}}}],"position":{"start":{"line":92,"column":1,"offset":2244},"end":{"line":92,"column":135,"offset":2378}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's take the ","position":{"start":{"line":94,"column":1,"offset":2380},"end":{"line":94,"column":16,"offset":2395}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"showAvatar()"}],"position":{"start":{"line":94,"column":16,"offset":2395},"end":{"line":94,"column":30,"offset":2409}}},{"type":"text","value":" example from the chapter ","position":{"start":{"line":94,"column":30,"offset":2409},"end":{"line":94,"column":56,"offset":2435}}},{"type":"element","tagName":"a","properties":{"href":"promise-chaining"},"children":[{"type":"text","value":"Promises chaining","position":{"start":{"line":94,"column":57,"offset":2436},"end":{"line":94,"column":74,"offset":2453}}}],"position":{"start":{"line":94,"column":56,"offset":2435},"end":{"line":94,"column":93,"offset":2472}}},{"type":"text","value":" and rewrite it using ","position":{"start":{"line":94,"column":93,"offset":2472},"end":{"line":94,"column":115,"offset":2494}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async/await"}],"position":{"start":{"line":94,"column":115,"offset":2494},"end":{"line":94,"column":128,"offset":2507}}},{"type":"text","value":":","position":{"start":{"line":94,"column":128,"offset":2507},"end":{"line":94,"column":129,"offset":2508}}}],"position":{"start":{"line":94,"column":1,"offset":2380},"end":{"line":94,"column":129,"offset":2508}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"We'll need to replace ","position":{"start":{"line":96,"column":5,"offset":2514},"end":{"line":96,"column":27,"offset":2536}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then"}],"position":{"start":{"line":96,"column":27,"offset":2536},"end":{"line":96,"column":34,"offset":2543}}},{"type":"text","value":" calls with ","position":{"start":{"line":96,"column":34,"offset":2543},"end":{"line":96,"column":46,"offset":2555}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":96,"column":46,"offset":2555},"end":{"line":96,"column":53,"offset":2562}}},{"type":"text","value":".","position":{"start":{"line":96,"column":53,"offset":2562},"end":{"line":96,"column":54,"offset":2563}}}],"position":{"start":{"line":96,"column":1,"offset":2510},"end":{"line":96,"column":54,"offset":2563}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Also we should make the function ","position":{"start":{"line":97,"column":5,"offset":2568},"end":{"line":97,"column":38,"offset":2601}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":97,"column":38,"offset":2601},"end":{"line":97,"column":45,"offset":2608}}},{"type":"text","value":" for them to work.","position":{"start":{"line":97,"column":45,"offset":2608},"end":{"line":97,"column":63,"offset":2626}}}],"position":{"start":{"line":97,"column":1,"offset":2564},"end":{"line":97,"column":63,"offset":2626}}},{"type":"text","value":"\n"}],"position":{"start":{"line":96,"column":1,"offset":2510},"end":{"line":97,"column":63,"offset":2626}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function showAvatar() {\n    // read our JSON\n    let response = await fetch('/article/promise-chaining/user.json');\n    let user = await response.json();\n\n    // read github user\n    let githubResponse = await fetch(`https://api.github.com/users/${user.name}`);\n    let githubUser = await githubResponse.json();\n\n    // show the avatar\n    let img = document.createElement('img');\n    img.src = githubUser.avatar_url;\n    img.className = 'promise-avatar-example';\n    document.body.append(img);\n\n    // wait 3 seconds\n    await new Promise((resolve, reject) => setTimeout(resolve, 3000));\n\n    img.remove();\n\n    return githubUser;\n}\n\nshowAvatar();\n"}],"position":{"start":{"line":99,"column":1,"offset":2628},"end":{"line":125,"column":4,"offset":3295}}}],"position":{"start":{"line":99,"column":1,"offset":2628},"end":{"line":125,"column":4,"offset":3295}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Pretty clean and easy to read, right? Much better than before.","position":{"start":{"line":127,"column":1,"offset":3297},"end":{"line":127,"column":63,"offset":3359}}}],"position":{"start":{"line":127,"column":1,"offset":3297},"end":{"line":127,"column":63,"offset":3359}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nawait` won't work in the top-level code\n\nPeople who are just starting to use `await` tend to forget the fact that we can't use `await` in top-level code. For example, this will not work:\n\n```js\n//\n// syntax error in top-level code\nlet response = await fetch('/article/promise-chaining/user.json');\nlet user = await response.json();\n"}],"position":{"start":{"line":129,"column":1,"offset":3361},"end":{"line":140,"column":4,"offset":3705}}}],"position":{"start":{"line":129,"column":1,"offset":3361},"end":{"line":140,"column":4,"offset":3705}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But we can wrap it into an anonymous async function, like this:","position":{"start":{"line":142,"column":1,"offset":3707},"end":{"line":142,"column":64,"offset":3770}}}],"position":{"start":{"line":142,"column":1,"offset":3707},"end":{"line":142,"column":64,"offset":3770}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\n(async () => {\n  let response = await fetch('/article/promise-chaining/user.json');\n  let user = await response.json();\n  ...\n})();\n"}],"position":{"start":{"line":144,"column":1,"offset":3772},"end":{"line":151,"column":4,"offset":3916}}}],"position":{"start":{"line":144,"column":1,"offset":3772},"end":{"line":151,"column":4,"offset":3916}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"P.S. New feature: starting from V8 engine version 8.9+, top-level await works in ","position":{"start":{"line":153,"column":1,"offset":3918},"end":{"line":153,"column":82,"offset":3999}}},{"type":"element","tagName":"a","properties":{"href":"modules"},"children":[{"type":"text","value":"modules","position":{"start":{"line":153,"column":83,"offset":4000},"end":{"line":153,"column":90,"offset":4007}}}],"position":{"start":{"line":153,"column":82,"offset":3999},"end":{"line":153,"column":100,"offset":4017}}},{"type":"text","value":".","position":{"start":{"line":153,"column":100,"offset":4017},"end":{"line":153,"column":101,"offset":4018}}}],"position":{"start":{"line":153,"column":1,"offset":3918},"end":{"line":153,"column":101,"offset":4018}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nawait` accepts \"thenables\"\n\nLike `promise.then`, `await` allows us to use thenable objects (those with a callable `then` method). The idea is that a third-party object may not be a promise, but promise-compatible: if it supports `.then`, that's enough to use it with `await`.\n\nHere's a demo `Thenable` class; the `await` below accepts its instances:\n\n```js\n//\nclass Thenable {\n  constructor(num) {\n    this.num = num;\n  }\n  then(resolve, reject) {\n    alert(resolve);\n    // resolve with this.num*2 after 1000ms\n    setTimeout(() => resolve(this.num * 2), 1000); // (*)\n  }\n}\n\nasync function f() {\n  // waits for 1 second, then result becomes 2\n  let result = await new Thenable(1);\n  alert(result);\n}\n\nf();\n"}],"position":{"start":{"line":155,"column":1,"offset":4020},"end":{"line":183,"column":4,"offset":4740}}}],"position":{"start":{"line":155,"column":1,"offset":4020},"end":{"line":183,"column":4,"offset":4740}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If ","position":{"start":{"line":185,"column":1,"offset":4742},"end":{"line":185,"column":4,"offset":4745}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":185,"column":4,"offset":4745},"end":{"line":185,"column":11,"offset":4752}}},{"type":"text","value":" gets a non-promise object with ","position":{"start":{"line":185,"column":11,"offset":4752},"end":{"line":185,"column":43,"offset":4784}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then"}],"position":{"start":{"line":185,"column":43,"offset":4784},"end":{"line":185,"column":50,"offset":4791}}},{"type":"text","value":", it calls that method providing the built-in functions ","position":{"start":{"line":185,"column":50,"offset":4791},"end":{"line":185,"column":106,"offset":4847}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"resolve"}],"position":{"start":{"line":185,"column":106,"offset":4847},"end":{"line":185,"column":115,"offset":4856}}},{"type":"text","value":" and ","position":{"start":{"line":185,"column":115,"offset":4856},"end":{"line":185,"column":120,"offset":4861}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"reject"}],"position":{"start":{"line":185,"column":120,"offset":4861},"end":{"line":185,"column":128,"offset":4869}}},{"type":"text","value":" as arguments (just as it does for a regular ","position":{"start":{"line":185,"column":128,"offset":4869},"end":{"line":185,"column":173,"offset":4914}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise"}],"position":{"start":{"line":185,"column":173,"offset":4914},"end":{"line":185,"column":182,"offset":4923}}},{"type":"text","value":" executor). Then ","position":{"start":{"line":185,"column":182,"offset":4923},"end":{"line":185,"column":199,"offset":4940}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":185,"column":199,"offset":4940},"end":{"line":185,"column":206,"offset":4947}}},{"type":"text","value":" waits until one of them is called (in the example above it happens in the line ","position":{"start":{"line":185,"column":206,"offset":4947},"end":{"line":185,"column":286,"offset":5027}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"(*)"}],"position":{"start":{"line":185,"column":286,"offset":5027},"end":{"line":185,"column":291,"offset":5032}}},{"type":"text","value":") and then proceeds with the result.","position":{"start":{"line":185,"column":291,"offset":5032},"end":{"line":185,"column":327,"offset":5068}}}],"position":{"start":{"line":185,"column":1,"offset":4742},"end":{"line":185,"column":327,"offset":5068}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Async class methods","position":{"start":{"line":187,"column":1,"offset":5070},"end":{"line":187,"column":20,"offset":5089}}}],"position":{"start":{"line":187,"column":1,"offset":5070},"end":{"line":187,"column":20,"offset":5089}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To declare an async class method, just prepend it with ","position":{"start":{"line":189,"column":1,"offset":5091},"end":{"line":189,"column":56,"offset":5146}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":189,"column":56,"offset":5146},"end":{"line":189,"column":63,"offset":5153}}},{"type":"text","value":":","position":{"start":{"line":189,"column":63,"offset":5153},"end":{"line":189,"column":64,"offset":5154}}}],"position":{"start":{"line":189,"column":1,"offset":5091},"end":{"line":189,"column":64,"offset":5154}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nclass Waiter {\n    async wait() {\n        return await Promise.resolve(1);\n    }\n}\n\nnew Waiter().wait().then(alert); // 1 (this is the same as (result => alert(result)))\n"}],"position":{"start":{"line":191,"column":1,"offset":5156},"end":{"line":200,"column":4,"offset":5338}}}],"position":{"start":{"line":191,"column":1,"offset":5156},"end":{"line":200,"column":4,"offset":5338}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The meaning is the same: it ensures that the returned value is a promise and enables ","position":{"start":{"line":202,"column":1,"offset":5340},"end":{"line":202,"column":86,"offset":5425}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":202,"column":86,"offset":5425},"end":{"line":202,"column":93,"offset":5432}}},{"type":"text","value":".","position":{"start":{"line":202,"column":93,"offset":5432},"end":{"line":202,"column":94,"offset":5433}}}],"position":{"start":{"line":202,"column":1,"offset":5340},"end":{"line":202,"column":94,"offset":5433}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"[Error handling]","position":{"start":{"line":204,"column":5,"offset":5439},"end":{"line":204,"column":19,"offset":5453}}}],"position":{"start":{"line":204,"column":1,"offset":5435},"end":{"line":204,"column":20,"offset":5454}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If a promise resolves normally, then ","position":{"start":{"line":206,"column":1,"offset":5456},"end":{"line":206,"column":38,"offset":5493}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await promise"}],"position":{"start":{"line":206,"column":38,"offset":5493},"end":{"line":206,"column":53,"offset":5508}}},{"type":"text","value":" returns the result. But in the case of a rejection, it throws the error, just as if there were a ","position":{"start":{"line":206,"column":53,"offset":5508},"end":{"line":206,"column":151,"offset":5606}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"throw"}],"position":{"start":{"line":206,"column":151,"offset":5606},"end":{"line":206,"column":158,"offset":5613}}},{"type":"text","value":" statement at that line.","position":{"start":{"line":206,"column":158,"offset":5613},"end":{"line":206,"column":182,"offset":5637}}}],"position":{"start":{"line":206,"column":1,"offset":5456},"end":{"line":206,"column":182,"offset":5637}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"This code:","position":{"start":{"line":208,"column":1,"offset":5639},"end":{"line":208,"column":11,"offset":5649}}}],"position":{"start":{"line":208,"column":1,"offset":5639},"end":{"line":208,"column":11,"offset":5649}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function f() {\n    await Promise.reject(new Error('Whoops!'));\n}\n"}],"position":{"start":{"line":210,"column":1,"offset":5651},"end":{"line":215,"column":4,"offset":5734}}}],"position":{"start":{"line":210,"column":1,"offset":5651},"end":{"line":215,"column":4,"offset":5734}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"...is the same as this:","position":{"start":{"line":217,"column":1,"offset":5736},"end":{"line":217,"column":24,"offset":5759}}}],"position":{"start":{"line":217,"column":1,"offset":5736},"end":{"line":217,"column":24,"offset":5759}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function f() {\n    throw new Error('Whoops!');\n}\n"}],"position":{"start":{"line":219,"column":1,"offset":5761},"end":{"line":224,"column":4,"offset":5828}}}],"position":{"start":{"line":219,"column":1,"offset":5761},"end":{"line":224,"column":4,"offset":5828}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In real situations, the promise may take some time before it rejects. In that case there will be a delay before ","position":{"start":{"line":226,"column":1,"offset":5830},"end":{"line":226,"column":113,"offset":5942}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":226,"column":113,"offset":5942},"end":{"line":226,"column":120,"offset":5949}}},{"type":"text","value":" throws an error.","position":{"start":{"line":226,"column":120,"offset":5949},"end":{"line":226,"column":137,"offset":5966}}}],"position":{"start":{"line":226,"column":1,"offset":5830},"end":{"line":226,"column":137,"offset":5966}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can catch that error using ","position":{"start":{"line":228,"column":1,"offset":5968},"end":{"line":228,"column":31,"offset":5998}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":228,"column":31,"offset":5998},"end":{"line":228,"column":43,"offset":6010}}},{"type":"text","value":", the same way as a regular ","position":{"start":{"line":228,"column":43,"offset":6010},"end":{"line":228,"column":71,"offset":6038}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"throw"}],"position":{"start":{"line":228,"column":71,"offset":6038},"end":{"line":228,"column":78,"offset":6045}}},{"type":"text","value":":","position":{"start":{"line":228,"column":78,"offset":6045},"end":{"line":228,"column":79,"offset":6046}}}],"position":{"start":{"line":228,"column":1,"offset":5968},"end":{"line":228,"column":79,"offset":6046}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function f() {\n    try {\n        let response = await fetch('http://no-such-url');\n    } catch (err) {\n        alert(err); // TypeError: failed to fetch\n    }\n}\n\nf();\n"}],"position":{"start":{"line":230,"column":1,"offset":6048},"end":{"line":241,"column":4,"offset":6233}}}],"position":{"start":{"line":230,"column":1,"offset":6048},"end":{"line":241,"column":4,"offset":6233}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the case of an error, the control jumps to the ","position":{"start":{"line":243,"column":1,"offset":6235},"end":{"line":243,"column":51,"offset":6285}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"catch"}],"position":{"start":{"line":243,"column":51,"offset":6285},"end":{"line":243,"column":58,"offset":6292}}},{"type":"text","value":" block. We can also wrap multiple lines:","position":{"start":{"line":243,"column":58,"offset":6292},"end":{"line":243,"column":98,"offset":6332}}}],"position":{"start":{"line":243,"column":1,"offset":6235},"end":{"line":243,"column":98,"offset":6332}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function f() {\n    try {\n        let response = await fetch('/no-user-here');\n        let user = await response.json();\n    } catch (err) {\n        // catches errors both in fetch and response.json\n        alert(err);\n    }\n}\n\nf();\n"}],"position":{"start":{"line":245,"column":1,"offset":6334},"end":{"line":258,"column":4,"offset":6584}}}],"position":{"start":{"line":245,"column":1,"offset":6334},"end":{"line":258,"column":4,"offset":6584}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we don't have ","position":{"start":{"line":260,"column":1,"offset":6586},"end":{"line":260,"column":18,"offset":6603}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":260,"column":18,"offset":6603},"end":{"line":260,"column":30,"offset":6615}}},{"type":"text","value":", then the promise generated by the call of the async function ","position":{"start":{"line":260,"column":30,"offset":6615},"end":{"line":260,"column":93,"offset":6678}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"f()"}],"position":{"start":{"line":260,"column":93,"offset":6678},"end":{"line":260,"column":98,"offset":6683}}},{"type":"text","value":" becomes rejected. We can append ","position":{"start":{"line":260,"column":98,"offset":6683},"end":{"line":260,"column":131,"offset":6716}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".catch"}],"position":{"start":{"line":260,"column":131,"offset":6716},"end":{"line":260,"column":139,"offset":6724}}},{"type":"text","value":" to handle it:","position":{"start":{"line":260,"column":139,"offset":6724},"end":{"line":260,"column":153,"offset":6738}}}],"position":{"start":{"line":260,"column":1,"offset":6586},"end":{"line":260,"column":153,"offset":6738}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync function f() {\n    let response = await fetch('http://no-such-url');\n}\n\n// f() becomes a rejected promise\nf().catch(alert); // TypeError: failed to fetch // (*)\n"}],"position":{"start":{"line":262,"column":1,"offset":6740},"end":{"line":270,"column":4,"offset":6919}}}],"position":{"start":{"line":262,"column":1,"offset":6740},"end":{"line":270,"column":4,"offset":6919}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If we forget to add ","position":{"start":{"line":272,"column":1,"offset":6921},"end":{"line":272,"column":21,"offset":6941}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".catch"}],"position":{"start":{"line":272,"column":21,"offset":6941},"end":{"line":272,"column":29,"offset":6949}}},{"type":"text","value":" there, then we get an unhandled promise error (viewable in the console). We can catch such errors using a global ","position":{"start":{"line":272,"column":29,"offset":6949},"end":{"line":272,"column":143,"offset":7063}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"unhandledrejection"}],"position":{"start":{"line":272,"column":143,"offset":7063},"end":{"line":272,"column":163,"offset":7083}}},{"type":"text","value":" event handler as described in the chapter ","position":{"start":{"line":272,"column":163,"offset":7083},"end":{"line":272,"column":206,"offset":7126}}},{"type":"element","tagName":"a","properties":{"href":"promise-error-handling"},"children":[{"type":"text","value":"Error handling with promises","position":{"start":{"line":272,"column":207,"offset":7127},"end":{"line":272,"column":235,"offset":7155}}}],"position":{"start":{"line":272,"column":206,"offset":7126},"end":{"line":272,"column":260,"offset":7180}}},{"type":"text","value":".","position":{"start":{"line":272,"column":260,"offset":7180},"end":{"line":272,"column":261,"offset":7181}}}],"position":{"start":{"line":272,"column":1,"offset":6921},"end":{"line":272,"column":261,"offset":7181}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync/await` and `promise.then/catch\n"}],"position":{"start":{"line":274,"column":1,"offset":7183},"end":{"line":277,"column":4,"offset":7232}}}],"position":{"start":{"line":274,"column":1,"offset":7183},"end":{"line":277,"column":4,"offset":7232}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we use ","position":{"start":{"line":279,"column":1,"offset":7234},"end":{"line":279,"column":13,"offset":7246}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async/await"}],"position":{"start":{"line":279,"column":13,"offset":7246},"end":{"line":279,"column":26,"offset":7259}}},{"type":"text","value":", we rarely need ","position":{"start":{"line":279,"column":26,"offset":7259},"end":{"line":279,"column":43,"offset":7276}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then"}],"position":{"start":{"line":279,"column":43,"offset":7276},"end":{"line":279,"column":50,"offset":7283}}},{"type":"text","value":", because ","position":{"start":{"line":279,"column":50,"offset":7283},"end":{"line":279,"column":60,"offset":7293}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":279,"column":60,"offset":7293},"end":{"line":279,"column":67,"offset":7300}}},{"type":"text","value":" handles the waiting for us. And we can use a regular ","position":{"start":{"line":279,"column":67,"offset":7300},"end":{"line":279,"column":121,"offset":7354}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":279,"column":121,"offset":7354},"end":{"line":279,"column":133,"offset":7366}}},{"type":"text","value":" instead of ","position":{"start":{"line":279,"column":133,"offset":7366},"end":{"line":279,"column":145,"offset":7378}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".catch"}],"position":{"start":{"line":279,"column":145,"offset":7378},"end":{"line":279,"column":153,"offset":7386}}},{"type":"text","value":". That's usually (but not always) more convenient.","position":{"start":{"line":279,"column":153,"offset":7386},"end":{"line":279,"column":203,"offset":7436}}}],"position":{"start":{"line":279,"column":1,"offset":7234},"end":{"line":279,"column":203,"offset":7436}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"But at the top level of the code, when we're outside any ","position":{"start":{"line":281,"column":1,"offset":7438},"end":{"line":281,"column":58,"offset":7495}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":281,"column":58,"offset":7495},"end":{"line":281,"column":65,"offset":7502}}},{"type":"text","value":" function, we're syntactically unable to use ","position":{"start":{"line":281,"column":65,"offset":7502},"end":{"line":281,"column":110,"offset":7547}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":281,"column":110,"offset":7547},"end":{"line":281,"column":117,"offset":7554}}},{"type":"text","value":", so it's a normal practice to add ","position":{"start":{"line":281,"column":117,"offset":7554},"end":{"line":281,"column":152,"offset":7589}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":".then/catch"}],"position":{"start":{"line":281,"column":152,"offset":7589},"end":{"line":281,"column":165,"offset":7602}}},{"type":"text","value":" to handle the final result or falling-through error, like in the line ","position":{"start":{"line":281,"column":165,"offset":7602},"end":{"line":281,"column":236,"offset":7673}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"(*)"}],"position":{"start":{"line":281,"column":236,"offset":7673},"end":{"line":281,"column":241,"offset":7678}}},{"type":"text","value":" of the example above.","position":{"start":{"line":281,"column":241,"offset":7678},"end":{"line":281,"column":263,"offset":7700}}}],"position":{"start":{"line":281,"column":1,"offset":7438},"end":{"line":281,"column":263,"offset":7700}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\nasync/await` works well with `Promise.all\n"}],"position":{"start":{"line":283,"column":1,"offset":7702},"end":{"line":286,"column":4,"offset":7756}}}],"position":{"start":{"line":283,"column":1,"offset":7702},"end":{"line":286,"column":4,"offset":7756}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When we need to wait for multiple promises, we can wrap them in ","position":{"start":{"line":288,"column":1,"offset":7758},"end":{"line":288,"column":65,"offset":7822}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise.all"}],"position":{"start":{"line":288,"column":65,"offset":7822},"end":{"line":288,"column":78,"offset":7835}}},{"type":"text","value":" and then ","position":{"start":{"line":288,"column":78,"offset":7835},"end":{"line":288,"column":88,"offset":7845}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":288,"column":88,"offset":7845},"end":{"line":288,"column":95,"offset":7852}}},{"type":"text","value":":","position":{"start":{"line":288,"column":95,"offset":7852},"end":{"line":288,"column":96,"offset":7853}}}],"position":{"start":{"line":288,"column":1,"offset":7758},"end":{"line":288,"column":96,"offset":7853}}},{"type":"text","value":"\n"},{"type":"element","tagName":"pre","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-js"]},"children":[{"type":"text","value":"//\n// wait for the array of results\nlet results = await Promise.all([\n  fetch(url1),\n  fetch(url2),\n  ...\n]);\n"}],"position":{"start":{"line":290,"column":1,"offset":7855},"end":{"line":298,"column":4,"offset":7974}}}],"position":{"start":{"line":290,"column":1,"offset":7855},"end":{"line":298,"column":4,"offset":7974}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In the case of an error, it propagates as usual, from the failed promise to ","position":{"start":{"line":300,"column":1,"offset":7976},"end":{"line":300,"column":77,"offset":8052}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise.all"}],"position":{"start":{"line":300,"column":77,"offset":8052},"end":{"line":300,"column":90,"offset":8065}}},{"type":"text","value":", and then becomes an exception that we can catch using ","position":{"start":{"line":300,"column":90,"offset":8065},"end":{"line":300,"column":146,"offset":8121}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"try..catch"}],"position":{"start":{"line":300,"column":146,"offset":8121},"end":{"line":300,"column":158,"offset":8133}}},{"type":"text","value":" around the call.","position":{"start":{"line":300,"column":158,"offset":8133},"end":{"line":300,"column":175,"offset":8150}}}],"position":{"start":{"line":300,"column":1,"offset":7976},"end":{"line":300,"column":175,"offset":8150}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"#summary"},"children":[{"type":"text","value":"Summary","position":{"start":{"line":302,"column":5,"offset":8156},"end":{"line":302,"column":12,"offset":8163}}}],"position":{"start":{"line":302,"column":4,"offset":8155},"end":{"line":302,"column":23,"offset":8174}}}],"position":{"start":{"line":302,"column":1,"offset":8152},"end":{"line":302,"column":23,"offset":8174}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The ","position":{"start":{"line":304,"column":1,"offset":8176},"end":{"line":304,"column":5,"offset":8180}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async"}],"position":{"start":{"line":304,"column":5,"offset":8180},"end":{"line":304,"column":12,"offset":8187}}},{"type":"text","value":" keyword before a function has two effects:","position":{"start":{"line":304,"column":12,"offset":8187},"end":{"line":304,"column":55,"offset":8230}}}],"position":{"start":{"line":304,"column":1,"offset":8176},"end":{"line":304,"column":55,"offset":8230}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Makes it always return a promise.","position":{"start":{"line":306,"column":5,"offset":8236},"end":{"line":306,"column":38,"offset":8269}}}],"position":{"start":{"line":306,"column":1,"offset":8232},"end":{"line":306,"column":38,"offset":8269}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Allows ","position":{"start":{"line":307,"column":5,"offset":8274},"end":{"line":307,"column":12,"offset":8281}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":307,"column":12,"offset":8281},"end":{"line":307,"column":19,"offset":8288}}},{"type":"text","value":" to be used in it.","position":{"start":{"line":307,"column":19,"offset":8288},"end":{"line":307,"column":37,"offset":8306}}}],"position":{"start":{"line":307,"column":1,"offset":8270},"end":{"line":307,"column":37,"offset":8306}}},{"type":"text","value":"\n"}],"position":{"start":{"line":306,"column":1,"offset":8232},"end":{"line":307,"column":37,"offset":8306}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The ","position":{"start":{"line":309,"column":1,"offset":8308},"end":{"line":309,"column":5,"offset":8312}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":309,"column":5,"offset":8312},"end":{"line":309,"column":12,"offset":8319}}},{"type":"text","value":" keyword before a promise makes JavaScript wait until that promise settles, and then:","position":{"start":{"line":309,"column":12,"offset":8319},"end":{"line":309,"column":97,"offset":8404}}}],"position":{"start":{"line":309,"column":1,"offset":8308},"end":{"line":309,"column":97,"offset":8404}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"If it's an error, the exception is generated --- same as if ","position":{"start":{"line":311,"column":5,"offset":8410},"end":{"line":311,"column":65,"offset":8470}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"throw error"}],"position":{"start":{"line":311,"column":65,"offset":8470},"end":{"line":311,"column":78,"offset":8483}}},{"type":"text","value":" were called at that very place.","position":{"start":{"line":311,"column":78,"offset":8483},"end":{"line":311,"column":110,"offset":8515}}}],"position":{"start":{"line":311,"column":1,"offset":8406},"end":{"line":311,"column":110,"offset":8515}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"Otherwise, it returns the result.","position":{"start":{"line":312,"column":5,"offset":8520},"end":{"line":312,"column":38,"offset":8553}}}],"position":{"start":{"line":312,"column":1,"offset":8516},"end":{"line":312,"column":38,"offset":8553}}},{"type":"text","value":"\n"}],"position":{"start":{"line":311,"column":1,"offset":8406},"end":{"line":312,"column":38,"offset":8553}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Together they provide a great framework to write asynchronous code that is easy to both read and write.","position":{"start":{"line":314,"column":1,"offset":8555},"end":{"line":314,"column":104,"offset":8658}}}],"position":{"start":{"line":314,"column":1,"offset":8555},"end":{"line":314,"column":104,"offset":8658}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"With ","position":{"start":{"line":316,"column":1,"offset":8660},"end":{"line":316,"column":6,"offset":8665}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"async/await"}],"position":{"start":{"line":316,"column":6,"offset":8665},"end":{"line":316,"column":19,"offset":8678}}},{"type":"text","value":" we rarely need to write ","position":{"start":{"line":316,"column":19,"offset":8678},"end":{"line":316,"column":44,"offset":8703}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"promise.then/catch"}],"position":{"start":{"line":316,"column":44,"offset":8703},"end":{"line":316,"column":64,"offset":8723}}},{"type":"text","value":", but we still shouldn't forget that they are based on promises, because sometimes (e.g. in the outermost scope) we have to use these methods. Also ","position":{"start":{"line":316,"column":64,"offset":8723},"end":{"line":316,"column":212,"offset":8871}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"Promise.all"}],"position":{"start":{"line":316,"column":212,"offset":8871},"end":{"line":316,"column":225,"offset":8884}}},{"type":"text","value":" is nice when we are waiting for many tasks simultaneously.","position":{"start":{"line":316,"column":225,"offset":8884},"end":{"line":316,"column":284,"offset":8943}}}],"position":{"start":{"line":316,"column":1,"offset":8660},"end":{"line":316,"column":284,"offset":8943}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"Cleaning up your asynchronous code with ","position":{"start":{"line":318,"column":4,"offset":8948},"end":{"line":318,"column":44,"offset":8988}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":318,"column":44,"offset":8988},"end":{"line":318,"column":51,"offset":8995}}}],"position":{"start":{"line":318,"column":1,"offset":8945},"end":{"line":318,"column":51,"offset":8995}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"REPLs have traditionally had a difficult time allowing you to interact with asynchronous code since they encourage a coding style where you evaluate expressions and use those results in the next field. But if you are using promises or callbacks, this breaks down because these results exist only in the callback, not the next line:","position":{"start":{"line":320,"column":1,"offset":8997},"end":{"line":320,"column":332,"offset":9328}}}],"position":{"start":{"line":320,"column":1,"offset":8997},"end":{"line":320,"column":332,"offset":9328}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In RunKit, you can use top-level ","position":{"start":{"line":322,"column":1,"offset":9330},"end":{"line":322,"column":34,"offset":9363}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":322,"column":34,"offset":9363},"end":{"line":322,"column":41,"offset":9370}}},{"type":"text","value":" to get the same behavior of synchronous code.","position":{"start":{"line":322,"column":41,"offset":9370},"end":{"line":322,"column":87,"offset":9416}}}],"position":{"start":{"line":322,"column":1,"offset":9330},"end":{"line":322,"column":87,"offset":9416}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Now we can treat this code as synchronous, despite the fact that the code is still executing asynchronously.","position":{"start":{"line":324,"column":1,"offset":9418},"end":{"line":324,"column":109,"offset":9526}}}],"position":{"start":{"line":324,"column":1,"offset":9418},"end":{"line":324,"column":109,"offset":9526}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Let's look how. It helps to have a more complex example, where we need to do a few asynchronous operations in sequence. You can see how ","position":{"start":{"line":326,"column":1,"offset":9528},"end":{"line":326,"column":137,"offset":9664}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":326,"column":137,"offset":9664},"end":{"line":326,"column":144,"offset":9671}}},{"type":"text","value":", promises and callbacks achieve the same results, but the ","position":{"start":{"line":326,"column":144,"offset":9671},"end":{"line":326,"column":203,"offset":9730}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":326,"column":203,"offset":9730},"end":{"line":326,"column":210,"offset":9737}}},{"type":"text","value":" style works better in a REPL:","position":{"start":{"line":326,"column":210,"offset":9737},"end":{"line":326,"column":240,"offset":9767}}}],"position":{"start":{"line":326,"column":1,"offset":9528},"end":{"line":326,"column":240,"offset":9767}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"await","position":{"start":{"line":328,"column":3,"offset":9771},"end":{"line":328,"column":8,"offset":9776}}}],"position":{"start":{"line":328,"column":1,"offset":9769},"end":{"line":328,"column":8,"offset":9776}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"promises","position":{"start":{"line":329,"column":3,"offset":9779},"end":{"line":329,"column":11,"offset":9787}}}],"position":{"start":{"line":329,"column":1,"offset":9777},"end":{"line":329,"column":11,"offset":9787}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"callbacks","position":{"start":{"line":330,"column":3,"offset":9790},"end":{"line":330,"column":12,"offset":9799}}}],"position":{"start":{"line":330,"column":1,"offset":9788},"end":{"line":330,"column":12,"offset":9799}}},{"type":"text","value":"\n"}],"position":{"start":{"line":328,"column":1,"offset":9769},"end":{"line":330,"column":12,"offset":9799}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Here, we use ","position":{"start":{"line":332,"column":1,"offset":9801},"end":{"line":332,"column":14,"offset":9814}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":332,"column":14,"offset":9814},"end":{"line":332,"column":21,"offset":9821}}},{"type":"text","value":" on lines 4 and 8, and the results from each request remain in scope.","position":{"start":{"line":332,"column":21,"offset":9821},"end":{"line":332,"column":90,"offset":9890}}}],"position":{"start":{"line":332,"column":1,"offset":9801},"end":{"line":332,"column":90,"offset":9890}}},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Remember, ","position":{"start":{"line":334,"column":1,"offset":9892},"end":{"line":334,"column":11,"offset":9902}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"await"}],"position":{"start":{"line":334,"column":11,"offset":9902},"end":{"line":334,"column":18,"offset":9909}}},{"type":"text","value":" expects a ","position":{"start":{"line":334,"column":18,"offset":9909},"end":{"line":334,"column":29,"offset":9920}}},{"type":"element","tagName":"code","properties":{},"children":[{"type":"text","value":"promise"}],"position":{"start":{"line":334,"column":29,"offset":9920},"end":{"line":334,"column":38,"offset":9929}}},{"type":"text","value":" so you can either write your own or use one of the many libraries that natively supports promises, and npm is full of packages that add promise support to existing libraries. Here are a few of our favorites:","position":{"start":{"line":334,"column":38,"offset":9929},"end":{"line":334,"column":246,"offset":10137}}}],"position":{"start":{"line":334,"column":1,"offset":9892},"end":{"line":334,"column":246,"offset":10137}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/fs-promise"},"children":[{"type":"text","value":"fs-promise","position":{"start":{"line":336,"column":4,"offset":10142},"end":{"line":336,"column":14,"offset":10152}}}],"position":{"start":{"line":336,"column":3,"offset":10141},"end":{"line":336,"column":50,"offset":10188}}},{"type":"text","value":" - promise based filesystem api","position":{"start":{"line":336,"column":50,"offset":10188},"end":{"line":336,"column":81,"offset":10219}}}],"position":{"start":{"line":336,"column":1,"offset":10139},"end":{"line":336,"column":81,"offset":10219}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/request-promise"},"children":[{"type":"text","value":"request-promise","position":{"start":{"line":337,"column":4,"offset":10223},"end":{"line":337,"column":19,"offset":10238}}}],"position":{"start":{"line":337,"column":3,"offset":10222},"end":{"line":337,"column":60,"offset":10279}}},{"type":"text","value":" - a wrapper around \"request\" for http stuff","position":{"start":{"line":337,"column":60,"offset":10279},"end":{"line":337,"column":104,"offset":10323}}}],"position":{"start":{"line":337,"column":1,"offset":10220},"end":{"line":337,"column":104,"offset":10323}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/glob-promise"},"children":[{"type":"text","value":"glob-promise","position":{"start":{"line":338,"column":4,"offset":10327},"end":{"line":338,"column":16,"offset":10339}}}],"position":{"start":{"line":338,"column":3,"offset":10326},"end":{"line":338,"column":54,"offset":10377}}},{"type":"text","value":" - glob style filesystem queries","position":{"start":{"line":338,"column":54,"offset":10377},"end":{"line":338,"column":86,"offset":10409}}}],"position":{"start":{"line":338,"column":1,"offset":10324},"end":{"line":338,"column":86,"offset":10409}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://npm.runkit.com/bluebird"},"children":[{"type":"text","value":"bluebird","position":{"start":{"line":339,"column":4,"offset":10413},"end":{"line":339,"column":12,"offset":10421}}}],"position":{"start":{"line":339,"column":3,"offset":10412},"end":{"line":339,"column":46,"offset":10455}}},{"type":"text","value":" - general promise library with lots of utilities","position":{"start":{"line":339,"column":46,"offset":10455},"end":{"line":339,"column":95,"offset":10504}}}],"position":{"start":{"line":339,"column":1,"offset":10410},"end":{"line":339,"column":95,"offset":10504}}},{"type":"text","value":"\n"}],"position":{"start":{"line":336,"column":1,"offset":10139},"end":{"line":339,"column":95,"offset":10504}}},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"Further Reading","position":{"start":{"line":341,"column":5,"offset":10510},"end":{"line":341,"column":20,"offset":10525}}}],"position":{"start":{"line":341,"column":1,"offset":10506},"end":{"line":341,"column":20,"offset":10525}}},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"http://rossboucher.com/await"},"children":[{"type":"text","value":"ES7 Async/Await presented at Brookyln.js","position":{"start":{"line":343,"column":4,"offset":10530},"end":{"line":343,"column":44,"offset":10570}}}],"position":{"start":{"line":343,"column":3,"offset":10529},"end":{"line":343,"column":75,"offset":10601}}}],"position":{"start":{"line":343,"column":1,"offset":10527},"end":{"line":343,"column":75,"offset":10601}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://babeljs.io/"},"children":[{"type":"text","value":"Babel.js","position":{"start":{"line":344,"column":4,"offset":10605},"end":{"line":344,"column":12,"offset":10613}}}],"position":{"start":{"line":344,"column":3,"offset":10604},"end":{"line":344,"column":34,"offset":10635}}}],"position":{"start":{"line":344,"column":1,"offset":10602},"end":{"line":344,"column":34,"offset":10635}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://github.com/lukehoban/ecmascript-asyncawait/"},"children":[{"type":"text","value":"ECMAScript's Proposal for async/await","position":{"start":{"line":345,"column":4,"offset":10639},"end":{"line":345,"column":41,"offset":10676}}}],"position":{"start":{"line":345,"column":3,"offset":10638},"end":{"line":345,"column":95,"offset":10730}}}],"position":{"start":{"line":345,"column":1,"offset":10636},"end":{"line":345,"column":95,"offset":10730}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://esdiscuss.org/notes/2014-01-30#async-await"},"children":[{"type":"text","value":"ES Meeting Notes discussing on async/await","position":{"start":{"line":346,"column":4,"offset":10734},"end":{"line":346,"column":46,"offset":10776}}}],"position":{"start":{"line":346,"column":3,"offset":10733},"end":{"line":346,"column":99,"offset":10829}}}],"position":{"start":{"line":346,"column":1,"offset":10731},"end":{"line":346,"column":99,"offset":10829}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://esdiscuss.org/topic/does-async-await-solve-a-real-problem"},"children":[{"type":"text","value":"Does async/await Solve a Real Problem?","position":{"start":{"line":347,"column":4,"offset":10833},"end":{"line":347,"column":42,"offset":10871}}}],"position":{"start":{"line":347,"column":3,"offset":10832},"end":{"line":347,"column":110,"offset":10939}}}],"position":{"start":{"line":347,"column":1,"offset":10830},"end":{"line":347,"column":110,"offset":10939}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://thomashunter.name/blog/the-long-road-to-asyncawait-in-javascript/"},"children":[{"type":"text","value":"The Long Road to async/await in JavaScript","position":{"start":{"line":348,"column":4,"offset":10943},"end":{"line":348,"column":46,"offset":10985}}}],"position":{"start":{"line":348,"column":3,"offset":10942},"end":{"line":348,"column":122,"offset":11061}}}],"position":{"start":{"line":348,"column":1,"offset":10940},"end":{"line":348,"column":122,"offset":11061}}},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.twilio.com/blog/2015/10/asyncawait-the-hero-javascript-deserved.html"},"children":[{"type":"text","value":"async/await: The Hero JavaScript Deserved","position":{"start":{"line":349,"column":4,"offset":11065},"end":{"line":349,"column":45,"offset":11106}}}],"position":{"start":{"line":349,"column":3,"offset":11064},"end":{"line":349,"column":128,"offset":11189}}}],"position":{"start":{"line":349,"column":1,"offset":11062},"end":{"line":349,"column":128,"offset":11189}}},{"type":"text","value":"\n"}],"position":{"start":{"line":343,"column":1,"offset":10527},"end":{"line":349,"column":128,"offset":11189}}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":350,"column":1,"offset":11190}}}}